package com.chat.videocall.user; // Proverite da li je paket ispravan

import java.util.ArrayList;
import java.util.HashMap;
import java.util.List;
import java.util.Map;
import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;

@RestController
public class IceConfigController {

    @Value("${stun.server.url}")
    private String stunServerUrl;

    @Value("${turn.server.url}")
    private String turnServerUrl;

    @Value("${turn.server.username}")
    private String turnServerUsername;

    @Value("${turn.server.password}")
    private String turnServerPassword;

    @GetMapping("https://spring-boot-videocall.onrender.com/api/iceConfig")
    public Map<String, Object> getIceConfig() {
        Map<String, Object> iceConfig = new HashMap<>();
        List<Map<String, String>> iceServers = new ArrayList<>();

        // Dodavanje STUN servera
        Map<String, String> stun = new HashMap<>();
        stun.put("urls", stunServerUrl);
        iceServers.add(stun);

        // Dodavanje TURN servera
        Map<String, String> turn = new HashMap<>();
        turn.put("urls", turnServerUrl);
        turn.put("username", turnServerUsername);
        turn.put("credential", turnServerPassword);
        iceServers.add(turn);

        iceConfig.put("iceServers", iceServers);
        return Map.of("iceServers", iceServers); // Direktno vraÄ‡a iceServers listu
    }
}
