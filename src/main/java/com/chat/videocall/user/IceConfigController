package com.chat.videocall.user;

import org.springframework.beans.factory.annotation.Value;
import org.springframework.web.bind.annotation.CrossOrigin;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RestController;
import java.util.List;
import java.util.Map;
import java.util.HashMap;

@RestController
@CrossOrigin(origins = "*")
public class IceConfigController {

    @Value("${stun.server.url}")
    private String stunServerUrl;

    @Value("${turn.server.url}")
    private String turnServerUrl;

    @Value("${turn.server.username}")
    private String turnServerUsername;

    @Value("${turn.server.password}")
    private String turnServerPassword;

    @GetMapping("/api/iceConfig")
    public Map<String, List<Map<String, String>>> getIceConfig() {
        List<Map<String, String>> iceServers = new ArrayList<>();

        // STUN
        Map<String, String> stun = new HashMap<>();
        stun.put("urls", stunServerUrl);
        iceServers.add(stun);

        // TURN
        Map<String, String> turn = new HashMap<>();
        turn.put("urls", turnServerUrl);
        turn.put("username", turnServerUsername);
        turn.put("credential", turnServerPassword);
        iceServers.add(turn);

        return Map.of("iceServers", iceServers);
    }
}
